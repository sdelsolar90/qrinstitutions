services:
  mongo:
    image: mongo:7
    container_name: qr-attendance-mongo
    restart: unless-stopped
    volumes:
      - mongo_data:/data/db

  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: qr-attendance-app
    depends_on:
      - mongo
    environment:
      PORT: 5000
      MONGO_URI: mongodb://mongo:27017/attendance
      QR_SECRET_KEY: change-me-in-prod
      APP_BASE_URL: http://localhost:5001
      QR_CODE_DIR: /app/frontend/public/qrcodes
      INSTITUTION_LOGO_DIR: /app/storage/institution-logos
      NODE_ENV: production
      ATTENDANCE_REQUIRE_ENROLLMENT: "true"
    ports:
      - "5001:5000"
    volumes:
      - institution_logo_data:/app/storage/institution-logos
    restart: unless-stopped

volumes:
  mongo_data:
  institution_logo_data:
