<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-6">
      <div class="flex justify-between items-center mb-5">
        <div>
          <h1 id="pageTitle" class="text-2xl font-bold text-gray-800">New Course</h1>
          <p id="pageSubtitle" class="text-sm text-gray-500 mt-1">Create a course in a dedicated page</p>
        </div>
        <button id="backBtn" class="bg-gray-700 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors">
          Back
        </button>
      </div>

      <div id="message" class="text-sm mb-3"></div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
        <div class="md:col-span-2">
          <label for="courseInstitutionSelect" class="block text-sm font-medium text-gray-700 mb-1">Institution</label>
          <select id="courseInstitutionSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></select>
          <p id="institutionHelp" class="text-xs text-gray-500 mt-1"></p>
        </div>

        <input type="text" id="courseProgramInput" placeholder="Program (e.g. Computer Science)"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        <input type="text" id="courseProgramVersionInput" placeholder="Program Version (e.g. 2026)"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">

        <input type="text" id="courseCodeInput" placeholder="Course Code (e.g. MATH101)"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        <input type="text" id="courseSectionInput" placeholder="Section (e.g. A)"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">

        <input type="text" id="courseNameInput" placeholder="Course Name"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 md:col-span-2">
        <input type="text" id="courseAcademicYearInput" placeholder="Academic Year (e.g. 2026)"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">

        <input type="time" id="courseStartTimeInput"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        <input type="time" id="courseEndTimeInput"
          class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>

      <div class="mt-3">
        <p class="text-sm font-medium text-gray-700 mb-2">Days of Week (optional)</p>
        <div class="grid grid-cols-4 md:grid-cols-7 gap-2 text-sm text-gray-700">
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="MON">Mon</label>
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="TUE">Tue</label>
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="WED">Wed</label>
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="THU">Thu</label>
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="FRI">Fri</label>
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="SAT">Sat</label>
          <label class="flex items-center gap-2"><input type="checkbox" class="courseDayInput" value="SUN">Sun</label>
        </div>
        <p class="text-xs text-gray-500 mt-1">If you set schedule, choose days + start + end time together.</p>
      </div>

      <div class="mt-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
        <h2 class="text-sm font-semibold text-gray-800 mb-3">Attendance Mode and Security Policy</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="md:col-span-2">
            <label for="courseDeliveryModeInput" class="block text-sm font-medium text-gray-700 mb-1">Delivery Mode</label>
            <select id="courseDeliveryModeInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="in_person">In Person</option>
              <option value="online">Online</option>
              <option value="hybrid">Hybrid</option>
            </select>
          </div>

          <label class="flex items-center gap-2 text-sm text-gray-700">
            <input type="checkbox" id="policySingleDeviceInput" checked>
            One device per course/day
          </label>
          <label class="flex items-center gap-2 text-sm text-gray-700">
            <input type="checkbox" id="policyRequireEnrollmentInput" checked>
            Require enrollment match
          </label>
          <label class="flex items-center gap-2 text-sm text-gray-700">
            <input type="checkbox" id="policyRequireSignatureInput" checked>
            Require signature
          </label>
          <label class="flex items-center gap-2 text-sm text-gray-700">
            <input type="checkbox" id="policyRequireIpAllowlistInput">
            Restrict by IP allowlist (campus ranges)
          </label>
          <label class="flex items-center gap-2 text-sm text-gray-700 md:col-span-2">
            <input type="checkbox" id="policyRequireGeofenceInput">
            Restrict by geofence (lat/lng/radius)
          </label>

          <div id="ipAllowlistBlock" class="md:col-span-2 hidden">
            <label for="policyIpAllowlistInput" class="block text-sm font-medium text-gray-700 mb-1">IP Allowlist (one IP or CIDR per line)</label>
            <textarea
              id="policyIpAllowlistInput"
              rows="4"
              placeholder="192.168.1.0/24&#10;10.0.0.15"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>

          <div id="geofenceBlock" class="md:col-span-2 hidden">
            <p class="text-sm font-medium text-gray-700 mb-2">Geofence</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
              <input type="number" step="any" id="policyGeofenceLatInput" placeholder="Latitude (e.g. -12.056)"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <input type="number" step="any" id="policyGeofenceLngInput" placeholder="Longitude (e.g. -77.084)"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <input type="number" step="1" id="policyGeofenceRadiusInput" placeholder="Radius meters (e.g. 120)"
                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
          </div>
        </div>
      </div>

      <div class="mt-5 flex items-center gap-2">
        <button id="saveBtn" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition-colors">
          Create and Return
        </button>
        <button id="cancelBtn" class="bg-white text-gray-800 border border-gray-300 px-5 py-2 rounded-lg hover:bg-gray-100 transition-colors">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = (window.location.origin && window.location.origin !== "null")
      ? window.location.origin
      : "http://127.0.0.1:5001";

    const authToken = localStorage.getItem("authToken");
    const authUserRaw = localStorage.getItem("authUser");
    const authUser = authUserRaw ? JSON.parse(authUserRaw) : null;
    const allowedRoles = ["superadmin", "admin", "institution_admin"];

    if (!authToken || !authUser || !allowedRoles.includes(authUser.role)) {
      window.location.href = "admin-dashboard.html";
    }

    const isGlobalAdmin = authUser?.role === "superadmin" || authUser?.role === "admin";
    const isInstitutionAdmin = authUser?.role === "institution_admin";
    const ALL_INSTITUTIONS_VALUE = "__all__";

    const pageParams = new URLSearchParams(window.location.search);
    const requestedMode = String(pageParams.get("mode") || "create").trim().toLowerCase();
    const requestedCourseId = String(pageParams.get("courseId") || "").trim();
    const pageMode = requestedMode === "edit" && requestedCourseId ? "edit" : "create";
    const requestedInstitutionId = String(pageParams.get("institutionId") || "").trim();
    const requestedReturnInstitutionId = String(pageParams.get("returnInstitutionId") || "").trim();
    const requestedReturnTo = String(pageParams.get("returnTo") || "").trim();
    const storedScope = String(localStorage.getItem("activeInstitutionScope") || "").trim();
    const normalizedRequestedInstitutionId =
      requestedInstitutionId && requestedInstitutionId !== ALL_INSTITUTIONS_VALUE
        ? requestedInstitutionId
        : "";

    let returnInstitutionId =
      requestedReturnInstitutionId ||
      (storedScope === "all" && isGlobalAdmin ? ALL_INSTITUTIONS_VALUE : normalizedRequestedInstitutionId);
    const returnToPath = requestedReturnTo;

    let editingCourseId = pageMode === "edit" ? requestedCourseId : "";
    let selectedInstitutionId = normalizedRequestedInstitutionId || localStorage.getItem("activeInstitutionId") || authUser?.institutionId || "";
    let institutionRows = [];
    let loadedCourse = null;

    axios.defaults.headers.common.Authorization = "Bearer " + authToken;
    axios.interceptors.request.use((config) => {
      const storedInstitutionId = localStorage.getItem("activeInstitutionId") || "";
      const scopedInstitutionId = isGlobalAdmin
        ? (selectedInstitutionId || storedInstitutionId)
        : (selectedInstitutionId || storedInstitutionId || authUser?.institutionId || "");

      if (scopedInstitutionId) {
        config.headers["X-Institution-Id"] = scopedInstitutionId;
      } else if (config.headers && Object.prototype.hasOwnProperty.call(config.headers, "X-Institution-Id")) {
        delete config.headers["X-Institution-Id"];
      }
      return config;
    });

    axios.interceptors.response.use(
      (response) => response,
      (error) => {
        const status = error?.response?.status;
        if (status === 401 || status === 403) {
          localStorage.removeItem("authToken");
          localStorage.removeItem("authUser");
          localStorage.removeItem("adminToken");
          localStorage.removeItem("activeInstitutionId");
          localStorage.removeItem("activeInstitutionName");
          localStorage.removeItem("activeInstitutionScope");
          window.location.href = "login.html";
        }
        return Promise.reject(error);
      }
    );

    function setMessage(message, type = "info") {
      const el = document.getElementById("message");
      if (!el) return;
      el.textContent = message || "";
      el.className = "text-sm mb-3";
      if (type === "error") el.classList.add("text-red-600");
      if (type === "success") el.classList.add("text-green-600");
      if (type === "info") el.classList.add("text-gray-600");
    }

    function canNavigateBackInApp() {
      return window.history.length > 1;
    }

    function goToReturnToPath() {
      if (!returnToPath) return false;
      try {
        const targetUrl = new URL(returnToPath, window.location.origin);
        if (targetUrl.origin !== window.location.origin) return false;
        window.location.href = targetUrl.pathname + targetUrl.search + targetUrl.hash;
        return true;
      } catch (error) {
        return false;
      }
    }

    function goBack({ preferHistory = true } = {}) {
      if (preferHistory && canNavigateBackInApp()) {
        window.history.back();
        return;
      }
      if (goToReturnToPath()) {
        return;
      }
      const targetInstitutionId = returnInstitutionId || selectedInstitutionId;
      const suffix = targetInstitutionId ? "?institutionId=" + encodeURIComponent(targetInstitutionId) : "";
      window.location.href = "admin-dashboard.html" + suffix;
    }

    function renderInstitutionOptions() {
      const select = document.getElementById("courseInstitutionSelect");
      const help = document.getElementById("institutionHelp");
      if (!select || !help) return;

      if (!institutionRows.length) {
        select.innerHTML = '<option value="">No institutions found</option>';
        select.disabled = true;
        help.textContent = "Create an institution first.";
        return;
      }

      select.innerHTML = institutionRows
        .map((institution) => '<option value="' + institution.id + '">' + institution.name + ' (' + (institution.code || '-') + ')</option>')
        .join("");

      if (!institutionRows.some((institution) => institution.id === selectedInstitutionId)) {
        selectedInstitutionId = institutionRows[0].id;
      }

      select.value = selectedInstitutionId;
      localStorage.setItem("activeInstitutionId", selectedInstitutionId);
      const active = institutionRows.find((institution) => institution.id === selectedInstitutionId);
      if (active?.name) {
        localStorage.setItem("activeInstitutionName", active.name);
      }

      if (pageMode === "edit") {
        select.disabled = true;
        help.textContent = "Institution is fixed while editing an existing course.";
        return;
      }

      if (isInstitutionAdmin) {
        select.disabled = true;
        help.textContent = "Institution Admin is scoped to the assigned institution.";
      } else {
        select.disabled = false;
        help.textContent = "Select the institution where the course will be created.";
      }
    }

    async function loadInstitutions() {
      try {
        const response = await axios.get(API_BASE + "/api/auth/institutions");
        institutionRows = response?.data?.data || [];
        renderInstitutionOptions();
      } catch (error) {
        setMessage(error.response?.data?.message || "Failed to load institutions.", "error");
      }
    }

    function parseIpAllowlistInput() {
      const raw = String(document.getElementById("policyIpAllowlistInput")?.value || "");
      return [...new Set(raw.split(/\r?\n/).map((line) => line.trim()).filter(Boolean))];
    }

    function readAttendancePolicyPayload() {
      const geofenceLatRaw = String(document.getElementById("policyGeofenceLatInput")?.value || "").trim();
      const geofenceLngRaw = String(document.getElementById("policyGeofenceLngInput")?.value || "").trim();
      const geofenceRadiusRaw = String(document.getElementById("policyGeofenceRadiusInput")?.value || "").trim();

      return {
        singleDevicePerDay: document.getElementById("policySingleDeviceInput")?.checked !== false,
        requireEnrollment: document.getElementById("policyRequireEnrollmentInput")?.checked !== false,
        requireSignature: document.getElementById("policyRequireSignatureInput")?.checked !== false,
        requireIpAllowlist: document.getElementById("policyRequireIpAllowlistInput")?.checked === true,
        ipAllowlist: parseIpAllowlistInput(),
        requireGeofence: document.getElementById("policyRequireGeofenceInput")?.checked === true,
        geofence: {
          lat: geofenceLatRaw ? Number(geofenceLatRaw) : null,
          lng: geofenceLngRaw ? Number(geofenceLngRaw) : null,
          radiusMeters: geofenceRadiusRaw ? Number(geofenceRadiusRaw) : null,
        },
      };
    }

    function updatePolicyVisibility() {
      const requireIpAllowlist = document.getElementById("policyRequireIpAllowlistInput")?.checked === true;
      const requireGeofence = document.getElementById("policyRequireGeofenceInput")?.checked === true;
      const ipAllowlistBlock = document.getElementById("ipAllowlistBlock");
      const geofenceBlock = document.getElementById("geofenceBlock");
      if (ipAllowlistBlock) ipAllowlistBlock.classList.toggle("hidden", !requireIpAllowlist);
      if (geofenceBlock) geofenceBlock.classList.toggle("hidden", !requireGeofence);
    }

    function formatIpAllowlistForInput(rows) {
      if (!Array.isArray(rows) || !rows.length) return "";
      return rows.map((row) => String(row || "").trim()).filter(Boolean).join("\n");
    }

    function applyModeTexts() {
      const pageTitle = document.getElementById("pageTitle");
      const pageSubtitle = document.getElementById("pageSubtitle");
      const saveBtn = document.getElementById("saveBtn");
      if (pageMode === "edit") {
        if (pageTitle) pageTitle.textContent = "Edit Course";
        if (pageSubtitle) pageSubtitle.textContent = "Update course mode, schedule and attendance policy";
        if (saveBtn) saveBtn.textContent = "Save and Return";
      } else {
        if (pageTitle) pageTitle.textContent = "New Course";
        if (pageSubtitle) pageSubtitle.textContent = "Create a course in a dedicated page";
        if (saveBtn) saveBtn.textContent = "Create and Return";
      }
    }

    function fillForm(course) {
      document.getElementById("courseProgramInput").value = course.program || "";
      document.getElementById("courseProgramVersionInput").value = course.programVersion || "";
      document.getElementById("courseCodeInput").value = course.code || "";
      document.getElementById("courseSectionInput").value = course.section || "";
      document.getElementById("courseNameInput").value = course.name || "";
      document.getElementById("courseAcademicYearInput").value = course.academicYear || "";
      document.getElementById("courseStartTimeInput").value = course.startTime || "";
      document.getElementById("courseEndTimeInput").value = course.endTime || "";
      document.querySelectorAll(".courseDayInput").forEach((input) => {
        input.checked = Array.isArray(course.daysOfWeek) && course.daysOfWeek.includes(input.value);
      });

      document.getElementById("courseDeliveryModeInput").value = course.deliveryMode || "in_person";
      const policy = course.attendancePolicy || {};
      document.getElementById("policySingleDeviceInput").checked = policy.singleDevicePerDay !== false;
      document.getElementById("policyRequireEnrollmentInput").checked = policy.requireEnrollment !== false;
      document.getElementById("policyRequireSignatureInput").checked = policy.requireSignature !== false;
      document.getElementById("policyRequireIpAllowlistInput").checked = policy.requireIpAllowlist === true;
      document.getElementById("policyRequireGeofenceInput").checked = policy.requireGeofence === true;
      document.getElementById("policyIpAllowlistInput").value = formatIpAllowlistForInput(policy.ipAllowlist);
      document.getElementById("policyGeofenceLatInput").value =
        policy.geofence?.lat === null || policy.geofence?.lat === undefined ? "" : String(policy.geofence.lat);
      document.getElementById("policyGeofenceLngInput").value =
        policy.geofence?.lng === null || policy.geofence?.lng === undefined ? "" : String(policy.geofence.lng);
      document.getElementById("policyGeofenceRadiusInput").value =
        policy.geofence?.radiusMeters === null || policy.geofence?.radiusMeters === undefined
          ? ""
          : String(policy.geofence.radiusMeters);
      updatePolicyVisibility();
    }

    async function loadCourseForEdit() {
      if (pageMode !== "edit" || !editingCourseId) return;
      try {
        const response = await axios.get(API_BASE + "/api/academic/courses/" + encodeURIComponent(editingCourseId));
        const course = response?.data?.data || null;
        if (!course) {
          setMessage("Course not found.", "error");
          return;
        }
        loadedCourse = course;
        if (course.institutionId) {
          selectedInstitutionId = String(course.institutionId);
          localStorage.setItem("activeInstitutionId", selectedInstitutionId);
          const row = institutionRows.find((institution) => institution.id === selectedInstitutionId);
          if (row?.name) localStorage.setItem("activeInstitutionName", row.name);
        }
        renderInstitutionOptions();
        fillForm(course);
      } catch (error) {
        setMessage(error.response?.data?.message || "Failed to load course for edit.", "error");
      }
    }

    function readPayload() {
      const deliveryMode = String(document.getElementById("courseDeliveryModeInput")?.value || "in_person").trim();
      return {
        institutionId: selectedInstitutionId,
        program: String(document.getElementById("courseProgramInput")?.value || "").trim(),
        programVersion: String(document.getElementById("courseProgramVersionInput")?.value || "").trim(),
        code: String(document.getElementById("courseCodeInput")?.value || "").trim(),
        name: String(document.getElementById("courseNameInput")?.value || "").trim(),
        section: String(document.getElementById("courseSectionInput")?.value || "").trim(),
        academicYear: String(document.getElementById("courseAcademicYearInput")?.value || "").trim(),
        startTime: String(document.getElementById("courseStartTimeInput")?.value || "").trim(),
        endTime: String(document.getElementById("courseEndTimeInput")?.value || "").trim(),
        daysOfWeek: Array.from(document.querySelectorAll(".courseDayInput:checked")).map((el) => el.value),
        deliveryMode,
        attendancePolicy: readAttendancePolicyPayload(),
      };
    }

    function validatePayload(payload) {
      if (!payload.institutionId) return "Select an institution first.";
      if (!payload.code || !payload.name || !payload.section) return "Code, name and section are required.";
      if (!["in_person", "online", "hybrid"].includes(String(payload.deliveryMode || "").toLowerCase())) {
        return "Delivery mode is invalid.";
      }

      const hasAnyScheduleInput = Boolean(payload.daysOfWeek.length || payload.startTime || payload.endTime);
      if (hasAnyScheduleInput) {
        if (!payload.daysOfWeek.length || !payload.startTime || !payload.endTime) {
          return "If you set schedule, choose days + start + end time.";
        }
        if (payload.startTime >= payload.endTime) {
          return "Start time must be earlier than end time.";
        }
      }

      const policy = payload.attendancePolicy || {};
      if (policy.requireIpAllowlist && (!Array.isArray(policy.ipAllowlist) || !policy.ipAllowlist.length)) {
        return "If IP restriction is enabled, add at least one IP or CIDR range.";
      }
      if (policy.requireGeofence) {
        const lat = Number(policy.geofence?.lat);
        const lng = Number(policy.geofence?.lng);
        const radius = Number(policy.geofence?.radiusMeters);
        if (!Number.isFinite(lat) || !Number.isFinite(lng)) {
          return "If geofence is enabled, latitude and longitude are required.";
        }
        if (!Number.isFinite(radius) || radius < 10 || radius > 100000) {
          return "Geofence radius must be between 10 and 100000 meters.";
        }
      }
      return "";
    }

    async function saveCourse() {
      const payload = readPayload();
      const validationError = validatePayload(payload);
      if (validationError) {
        setMessage(validationError, "error");
        return;
      }

      const saveBtn = document.getElementById("saveBtn");
      if (saveBtn) saveBtn.disabled = true;

      try {
        if (pageMode === "edit" && editingCourseId) {
          await axios.put(API_BASE + "/api/academic/courses/" + encodeURIComponent(editingCourseId), payload);
          setMessage("Course updated successfully.", "success");
        } else {
          await axios.post(API_BASE + "/api/academic/courses", payload);
          setMessage("Course created successfully.", "success");
        }
        setTimeout(() => goBack({ preferHistory: false }), 500);
      } catch (error) {
        setMessage(
          error.response?.data?.message || (pageMode === "edit" ? "Failed to update course." : "Failed to create course."),
          "error"
        );
      } finally {
        if (saveBtn) saveBtn.disabled = false;
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      applyModeTexts();
      await loadInstitutions();
      await loadCourseForEdit();
      updatePolicyVisibility();

      const institutionSelect = document.getElementById("courseInstitutionSelect");
      if (institutionSelect) {
        institutionSelect.addEventListener("change", () => {
          if (pageMode === "edit") return;
          selectedInstitutionId = String(institutionSelect.value || "").trim();
          if (!selectedInstitutionId) return;
          localStorage.setItem("activeInstitutionId", selectedInstitutionId);
          const active = institutionRows.find((institution) => institution.id === selectedInstitutionId);
          if (active?.name) {
            localStorage.setItem("activeInstitutionName", active.name);
          }
        });
      }

      const deliveryModeInput = document.getElementById("courseDeliveryModeInput");
      if (deliveryModeInput) {
        deliveryModeInput.addEventListener("change", () => {
          if (deliveryModeInput.value === "online") {
            const geofenceToggle = document.getElementById("policyRequireGeofenceInput");
            if (geofenceToggle && geofenceToggle.checked) {
              geofenceToggle.checked = false;
            }
          }
          updatePolicyVisibility();
        });
      }

      const requireIpToggle = document.getElementById("policyRequireIpAllowlistInput");
      if (requireIpToggle) {
        requireIpToggle.addEventListener("change", updatePolicyVisibility);
      }

      const requireGeofenceToggle = document.getElementById("policyRequireGeofenceInput");
      if (requireGeofenceToggle) {
        requireGeofenceToggle.addEventListener("change", updatePolicyVisibility);
      }

      const saveBtn = document.getElementById("saveBtn");
      if (saveBtn) {
        saveBtn.addEventListener("click", saveCourse);
      }

      const backBtn = document.getElementById("backBtn");
      if (backBtn) {
        backBtn.addEventListener("click", () => goBack({ preferHistory: true }));
      }

      const cancelBtn = document.getElementById("cancelBtn");
      if (cancelBtn) {
        cancelBtn.addEventListener("click", () => goBack({ preferHistory: true }));
      }
    });
  </script>
</body>
</html>
